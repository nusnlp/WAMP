(function(){if(document.createRange){return}var e={findChildPosition:function(h){for(var g=0;h=h.previousSibling;g++){continue}return g},isDataNode:function(g){return g&&g.nodeValue!==null&&g.data!==null},isAncestorOf:function(g,h){return !e.isDataNode(g)&&(g.contains(e.isDataNode(h)?h.parentNode:h)||h.parentNode==g)},isAncestorOrSelf:function(g,h){return e.isAncestorOf(g,h)||g==h},findClosestAncestor:function(g,h){if(e.isAncestorOf(g,h)){while(h&&h.parentNode!=g){h=h.parentNode}}return h},getNodeLength:function(g){return e.isDataNode(g)?g.length:g.childNodes.length},splitDataNode:function(h,i){if(!e.isDataNode(h)){return false}var g=h.cloneNode(false);h.deleteData(i,h.length);g.deleteData(0,i);h.parentNode.insertBefore(g,h.nextSibling)}};var c={convertToDOMRange:function(j,g){function i(r,t,s){var k=g.createElement("a"),q=t.duplicate();q.collapse(s);var p=q.parentElement();do{p.insertBefore(k,k.previousSibling);q.moveToElementText(k)}while(q.compareEndPoints(s?"StartToStart":"StartToEnd",t)>0&&k.previousSibling);if(q.compareEndPoints(s?"StartToStart":"StartToEnd",t)==-1&&k.nextSibling){q.setEndPoint(s?"EndToStart":"EndToEnd",t);var l=q.text,o=0,n=k.nextSibling.data,m=0;for(o=0;o<l.length&&m<n.length;o++){if(l.charAt(o)==n.charAt(m)){m++}}r[s?"setStart":"setEnd"](k.nextSibling,m)}else{r[s?"setStartBefore":"setEndBefore"](k)}k.parentNode.removeChild(k)}var h=new f(g);i(h,j,true);i(h,j,false);return h},convertFromDOMRange:function(g){function i(j,q){var n=g._document.body.createTextRange();var o=0;var l=e.isDataNode(j)?j:j.childNodes[q];var k=e.isDataNode(j)?j.parentNode:j;if(j.nodeType==3||j.nodeType==4){o=q}var m=g._document.createElement("b");if(l){k.insertBefore(m,l)}else{k.insertBefore(m)}var p=g._document.body.createTextRange();p.moveToElementText(m);m.parentNode.removeChild(m);n.setEndPoint("StartToEnd",p);n.moveStart("character",o);n.collapse(true);return n}var h=g._document.body.createTextRange();h.setEndPoint("StartToEnd",i(g.startContainer,g.startOffset));h.setEndPoint("EndToEnd",i(g.endContainer,g.endOffset));return h}};function f(g){this._document=g;this.startContainer=this.endContainer=g.body;this.endOffset=e.getNodeLength(g.body)}f.START_TO_START=0;f.START_TO_END=1;f.END_TO_END=2;f.END_TO_START=3;f.prototype={startContainer:null,startOffset:0,endContainer:null,endOffset:0,commonAncestorContainer:null,collapsed:false,_document:null,_refreshProperties:function(){this.collapsed=(this.startContainer==this.endContainer&&this.startOffset==this.endOffset);var g=this.startContainer;while(g&&g!=this.endContainer&&!e.isAncestorOf(g,this.endContainer)){g=g.parentNode}this.commonAncestorContainer=g},setStart:function(g,h){this.startContainer=g;this.startOffset=h;this._refreshProperties()},setEnd:function(g,h){this.endContainer=g;this.endOffset=h;this._refreshProperties()},setStartBefore:function(g){this.setStart(g.parentNode,e.findChildPosition(g))},setStartAfter:function(g){this.setStart(g.parentNode,e.findChildPosition(g)+1)},setEndBefore:function(g){this.setEnd(g.parentNode,e.findChildPosition(g))},setEndAfter:function(g){this.setEnd(g.parentNode,e.findChildPosition(g)+1)},selectNode:function(g){this.setStartBefore(g);this.setEndAfter(g)},selectNodeContents:function(g){this.setStart(g,0);this.setEnd(g,e.getNodeLength(g))},collapse:function(g){if(g){this.setEnd(this.startContainer,this.startOffset)}else{this.setStart(this.endContainer,this.endOffset)}},cloneContents:function(){return(function g(h){for(var i,j=document.createDocumentFragment();i=h.next();){i=i.cloneNode(!h.hasPartialSubtree());if(h.hasPartialSubtree()){i.appendChild(g(h.getSubtreeIterator()))}j.appendChild(i)}return j})(new d(this))},extractContents:function(){var g=this.cloneRange();if(this.startContainer!=this.commonAncestorContainer){this.setStartAfter(e.findClosestAncestor(this.commonAncestorContainer,this.startContainer))}this.collapse(true);return(function h(i){for(var j,k=document.createDocumentFragment();j=i.next();){i.hasPartialSubtree()?j=j.cloneNode(false):i.remove();if(i.hasPartialSubtree()){j.appendChild(h(i.getSubtreeIterator()))}k.appendChild(j)}return k})(new d(g))},deleteContents:function(){var g=this.cloneRange();if(this.startContainer!=this.commonAncestorContainer){this.setStartAfter(e.findClosestAncestor(this.commonAncestorContainer,this.startContainer))}this.collapse(true);(function h(i){while(i.next()){i.hasPartialSubtree()?h(i.getSubtreeIterator()):i.remove()}})(new d(g))},insertNode:function(g){if(e.isDataNode(this.startContainer)){e.splitDataNode(this.startContainer,this.startOffset);this.startContainer.parentNode.insertBefore(g,this.startContainer.nextSibling)}else{if(this.startContainer.childNodes.length>this.startOffset){this.startContainer.insertBefore(g,this.startContainer.childNodes[this.startOffset])}else{this.startContainer.appendChild(g)}}this.setStart(this.startContainer,this.startOffset)},surroundContents:function(g){var h=this.extractContents();this.insertNode(g);g.appendChild(h);this.selectNode(g)},compareBoundaryPoints:function(t,p){var l,q,j,n;switch(t){case f.START_TO_START:case f.START_TO_END:l=this.startContainer;q=this.startOffset;break;case f.END_TO_END:case f.END_TO_START:l=this.endContainer;q=this.endOffset;break}switch(t){case f.START_TO_START:case f.END_TO_START:j=p.startContainer;n=p.startOffset;break;case f.START_TO_END:case f.END_TO_END:j=p.endContainer;n=p.endOffset;break}var h=3,k=1;if(l==j){if(q<n){return -1}else{if(q>n){return 1}else{return 0}}}if(l.nodeType==h&&l!=j){var s=l.parentNode.childNodes;for(var m=0;m<s.length;m++){if(s[m]==l){q=m;break}}l=l.parentNode}if(j.nodeType==h&&l!=j){var s=j.parentNode.childNodes;for(var m=0;m<s.length;m++){if(s[m]==j){n=m;break}}j=j.parentNode}if(l.contains(j)){for(var r=0;r<l.childNodes.length;r++){if(l.childNodes[r].nodeType==k&&l.childNodes[r].contains(j)){if(q<=r){return -1}else{return 1}}}}if(j.contains(l)){for(r=0;r<j.childNodes.length;r++){if(j.childNodes[r].nodeType==k&&j.childNodes[r].contains(l)){if(r<n){return -1}else{return 1}}}}var o=l.parentNode;while(o.contains(j)==false){o=o.parentNode}var v=-1,u=-1;for(var m=0;m<o.childNodes.length;m++){var g=o.childNodes[m];if(!g.contains){continue}if(g.contains(l)){v=m}if(g.contains(j)){u=m}if(v!=-1&&u!=-1){break}}if(v<u){return -1}else{return 1}},cloneRange:function(){var g=new f(this._document);g.setStart(this.startContainer,this.startOffset);g.setEnd(this.endContainer,this.endOffset);return g},detach:function(){},toString:function(){return new Error("Do NOT use this, since the behaviour is incorrect! See comments in code for details.")},createContextualFragment:function(g){var i=(e.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer).cloneNode(false);i.innerHTML=g;for(var h=this._document.createDocumentFragment();i.firstChild;){h.appendChild(i.firstChild)}return h}};function d(h){this.range=h;if(h.collapsed){return}var g=h.commonAncestorContainer;this._next=h.startContainer==g&&!e.isDataNode(h.startContainer)?h.startContainer.childNodes[h.startOffset]:e.findClosestAncestor(g,h.startContainer);this._end=h.endContainer==g&&!e.isDataNode(h.endContainer)?h.endContainer.childNodes[h.endOffset]:e.findClosestAncestor(g,h.endContainer).nextSibling}d.prototype={range:null,_current:null,_next:null,_end:null,hasNext:function(){return !!this._next},next:function(){var g=this._current=this._next;this._next=this._current&&this._current.nextSibling!=this._end?this._current.nextSibling:null;if(e.isDataNode(this._current)){if(this.range.endContainer==this._current){(g=g.cloneNode(true)).deleteData(this.range.endOffset,g.length-this.range.endOffset)}if(this.range.startContainer==this._current){(g=g.cloneNode(true)).deleteData(0,this.range.startOffset)}}return g},remove:function(){if(e.isDataNode(this._current)&&(this.range.startContainer==this._current||this.range.endContainer==this._current)){var h=this.range.startContainer==this._current?this.range.startOffset:0;var g=this.range.endContainer==this._current?this.range.endOffset:this._current.length;this._current.deleteData(h,g-h)}else{this._current.parentNode.removeChild(this._current)}},hasPartialSubtree:function(){return !e.isDataNode(this._current)&&(e.isAncestorOrSelf(this._current,this.range.startContainer)||e.isAncestorOrSelf(this._current,this.range.endContainer))},getSubtreeIterator:function(){var g=new f(this.range._document);g.selectNodeContents(this._current);if(e.isAncestorOrSelf(this._current,this.range.startContainer)){g.setStart(this.range.startContainer,this.range.startOffset)}if(e.isAncestorOrSelf(this._current,this.range.endContainer)){g.setEnd(this.range.endContainer,this.range.endOffset)}return new d(g)}};function b(g){this._document=g;var h=this;this.prevFunc=g.onselectionchange;g.onselectionchange=function(i){h._selectionChangeHandler()}}b.prototype={rangeCount:0,_document:null,_selectionChangeHandler:function(){if(this.prevFunc){this.prevFunc()}this.rangeCount=this._selectionExists(this._document.selection.createRange())?1:0},_selectionExists:function(g){return g.compareEndPoints("StartToEnd",g)!=0||g.parentElement().isContentEditable},addRange:function(g){var h=this._document.selection.createRange(),i=c.convertFromDOMRange(g);if(!this._selectionExists(h)){i.select()}else{if(i.compareEndPoints("StartToStart",h)==-1){if(i.compareEndPoints("StartToEnd",h)>-1&&i.compareEndPoints("EndToEnd",h)==-1){h.setEndPoint("StartToStart",i)}else{if(i.compareEndPoints("EndToStart",h)<1&&i.compareEndPoints("EndToEnd",h)>-1){h.setEndPoint("EndToEnd",i)}}}h.select()}},removeAllRanges:function(){this._document.selection.empty();this._selectionChangeHandler()},getRangeAt:function(g){var h=this._document.selection.createRange();if(this._selectionExists(h)){return c.convertToDOMRange(h,this._document)}return null},toString:function(){return this._document.selection.createRange().text}};document.createRange=function(){return new f(document)};var a=new b(document);window.getSelection=function(){return a}})();